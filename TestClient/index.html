<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebSocket Test Client</title>
    <link rel="shortcut icon" href="./favicon.png">
</head>
<body>
<script>
    function log(value) {
        console.log(value)
    }

    class socketHelper {
        constructor(event = '', data = '', from = '', to = '') {
            this.sendData = {}
            this.sendData.event = event
            this.sendData.data = data
            this.sendData.from = from
            this.sendData.to = to
        }

        getSendData() {
            return JSON.stringify(this.sendData)
        }
    }

    // https://developer.mozilla.org/zh-CN/docs/Web/API/WebSockets_API/Writing_WebSocket_client_applications
    var ws = new WebSocket("ws://127.0.0.1:8282")

    // webSocket 连接时触发, 只发送一次
    ws.onopen = function (event) {
        log('onopen:')

        // log(event);

        // 构造发送的数据, socket 一般只做转发
        sh = new socketHelper(
            "onopen",
            {
                age: 29,
                name: "linxl",
                student_ids: [1, 2, 3]
            }
        )

        ws.send(sh.getSendData());

        // 特殊事件名约定, socket 服务器把当前客户加入指定 group
        sh = new socketHelper(
            "join_group",
            [
                "live1",
                "teacher1"
            ]
        );

        ws.send(sh.getSendData());
    }

    // 收到 socket 数据处理
    ws.onmessage = function (event) {
        var serverData = JSON.parse(event.data)

        log('onmessage:')

        log(serverData)
    }

    ws.onclose = function (event) {
        log('onclose:')
    }

    ws.onerror = function() {
        log('onerror:')
    }

    // 关闭链接
    // ws.close();
</script>
</body>
</html>